<!DOCTYPE html>

<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Responda</title>

  <meta name="theme-color" content="#667eea">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      user-select: none;
    }
    
    /* Status Bar */
    .status-bar {
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      color: #fff;
      font-size: 15px;
      font-weight: 600;
    }
    
    .time { font-feature-settings: "tnum"; }
    
    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 0.5px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }
    
    .logout-btn:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Main Content */
    .content {
      height: calc(100vh - 44px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px 20px 120px;
    }
    
    /* Widgets */
    .widgets {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 32px;
    }
    
    .widget {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-radius: 20px;
      padding: 16px;
      color: #fff;
      min-height: 120px;
      border: 0.5px solid rgba(255, 255, 255, 0.3);
    }
    
    .widget.large {
      grid-column: span 2;
    }
    
    .widget-title {
      font-size: 13px;
      font-weight: 600;
      opacity: 0.8;
      margin-bottom: 8px;
    }
    
    .widget-value {
      font-size: 28px;
      font-weight: 700;
    }
    
    .widget-label {
      font-size: 14px;
      opacity: 0.8;
      margin-top: 4px;
    }
    
    /* Apps Grid */
    .apps {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px 16px;
      padding: 0 8px;
      margin-bottom: 48px;
    }
    
    .app {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      position: relative;
      transition: transform 0.2s;
    }
    
    .app:active { transform: scale(0.9); }
    
    .edit-mode .app {
      animation: wiggle 0.4s ease-in-out infinite;
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(-1deg); }
      50% { transform: rotate(1deg); }
    }
    
    .app-icon {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      border: 0.5px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .app-icon svg {
      width: 28px;
      height: 28px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    
    .app-name {
      font-size: 11px;
      font-weight: 500;
      color: #fff;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      max-width: 65px;
      line-height: 1.2;
    }
    
    .remove-btn {
      position: absolute;
      top: -5px;
      left: -5px;
      width: 20px;
      height: 20px;
      background: #ff3b30;
      border: 2px solid #fff;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      z-index: 10;
    }
    
    .edit-mode .remove-btn {
      display: flex;
    }
    
    /* Edit Section */
    .edit-section {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-radius: 28px 28px 0 0;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 200;
    }
    
    .edit-section.collapsed {
      transform: translateY(calc(100% - 70px));
    }
    
    .edit-toggle {
      padding: 24px 24px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .edit-toggle-text {
      font-size: 16px;
      font-weight: 600;
      color: #667eea;
    }
    
    .edit-toggle-icon {
      width: 20px;
      height: 20px;
      color: #667eea;
      transition: transform 0.3s;
    }
    
    .edit-section.collapsed .edit-toggle-icon {
      transform: rotate(180deg);
    }
    
    .edit-toggle-icon svg {
      width: 100%;
      height: 100%;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    
    .edit-content {
      padding: 0 24px 32px;
    }
    
    .edit-title {
      font-size: 22px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 20px;
      margin-top: 20px;
    }
    
    .edit-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .edit-btn {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 14px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 15px;
      color: #1a1a1a;
      font-weight: 500;
    }
    
    .edit-btn:active {
      transform: scale(0.98);
      background: #f5f5f5;
    }
    
    .edit-btn-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .edit-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    
    .edit-icon svg {
      width: 18px;
      height: 18px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    
    .edit-arrow {
      color: #999;
      font-size: 18px;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: flex-end;
      z-index: 1000;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      width: 100%;
      background: #fff;
      border-radius: 28px 28px 0 0;
      padding: 24px 24px 40px;
      max-height: 75vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #1a1a1a;
    }
    
    .modal-close {
      width: 32px;
      height: 32px;
      background: #f0f0f0;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #666;
      cursor: pointer;
    }
    
    /* Available Apps Grid */
    .available-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px 16px;
    }
    
    .available-app {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .available-app:active {
      transform: scale(0.9);
    }
    
    .available-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      position: relative;
    }
    
    .available-icon svg {
      width: 28px;
      height: 28px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    
    .available-icon::after {
      content: '+';
      position: absolute;
      bottom: -4px;
      right: -4px;
      width: 18px;
      height: 18px;
      background: #34c759;
      border: 2px solid #fff;
      border-radius: 50%;
      font-size: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .available-name {
      font-size: 11px;
      font-weight: 500;
      color: #1a1a1a;
      text-align: center;
      max-width: 65px;
    }
    
    /* Dock */
    .dock {
      position: fixed;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-radius: 20px;
      padding: 8px 20px;
      display: flex;
      gap: 24px;
      border: 0.5px solid rgba(255, 255, 255, 0.3);
      z-index: 100;
    }
    
    .dock-icon {
      width: 56px;
      height: 56px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-decoration: none;
      border: 0.5px solid rgba(255, 255, 255, 0.3);
    }
    
    .dock-icon:active {
      transform: scale(0.9);
    }
    
    .dock-icon svg {
      width: 26px;
      height: 26px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    
    /* Widgets Modal */
    .widget-options {
      display: grid;
      gap: 12px;
    }
    
    .widget-option {
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
    }
    
    .widget-option:active {
      background: #f0f0f0;
    }
    
    .widget-option-title {
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
    }
    
    .widget-option-desc {
      font-size: 13px;
      color: #666;
    }
    
    /* Loading */
    body.loading { opacity: 0; }
    body.loaded { 
      opacity: 1;
      transition: opacity 0.3s;
    }
    
    @media (min-width: 768px) {
      .content {
        max-width: 600px;
        margin: 0 auto;
      }
    }
  </style>

</head>

<body class="loading">

<!-- Status Bar -->

<div class="status-bar">
  <div class="time" id="time">9:41</div>
  <div id="userName">—</div>
  <button class="logout-btn" id="logoutBtn">Abmelden</button>
</div>

<!-- Main Content -->

<div class="content">
  <!-- Widgets -->
  <div class="widgets" id="widgets"></div>

  <!-- Apps -->

  <div class="apps" id="apps"></div>
</div>

<!-- Dock -->

<div class="dock" id="dock"></div>

<!-- Edit Section -->

<div class="edit-section collapsed" id="editSection">
  <div class="edit-toggle" id="editToggle">
    <span class="edit-toggle-text">Hub bearbeiten</span>
    <div class="edit-toggle-icon">
      <svg viewBox="0 0 24 24"><path d="M18 15l-6-6-6 6"/></svg>
    </div>
  </div>
  <div class="edit-content">
    <div class="edit-title">Optionen</div>
    <div class="edit-options">
      <button class="edit-btn" id="editAppsBtn">
        <div class="edit-btn-left">
          <div class="edit-icon">
            <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          </div>
          <span>Apps verwalten</span>
        </div>
        <span class="edit-arrow">›</span>
      </button>

```
  <button class="edit-btn" id="editWidgetsBtn">
    <div class="edit-btn-left">
      <div class="edit-icon">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
      </div>
      <span>Widgets anpassen</span>
    </div>
    <span class="edit-arrow">›</span>
  </button>
</div>
```

  </div>
</div>

<!-- Apps Modal -->

<div class="modal" id="appsModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Apps verwalten</div>
      <button class="modal-close" onclick="closeModal('appsModal')">×</button>
    </div>
    <div class="available-grid" id="availableApps"></div>
  </div>
</div>

<!-- Widgets Modal -->

<div class="modal" id="widgetsModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Widgets anpassen</div>
      <button class="modal-close" onclick="closeModal('widgetsModal')">×</button>
    </div>
    <div class="widget-options">
      <div class="widget-option">
        <div class="widget-option-title">Datum & Uhrzeit</div>
        <div class="widget-option-desc">Zeigt aktuelles Datum und Wochentag</div>
      </div>
      <div class="widget-option">
        <div class="widget-option-title">Apps-Übersicht</div>
        <div class="widget-option-desc">Anzahl installierter Apps</div>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import PocketBase from 'https://cdn.jsdelivr.net/npm/pocketbase@0.21.3/dist/pocketbase.es.mjs';
  const pb = new PocketBase('https://api.responda.systems');

  // Icons
  const ICONS = {
    siren: '<svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',
    clipboard: '<svg viewBox="0 0 24 24"><rect x="8" y="2" width="8" height="4" rx="1"/><rect x="4" y="4" width="16" height="18" rx="2"/></svg>',
    file: '<svg viewBox="0 0 24 24"><path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9l-7-7z"/><path d="M13 2v7h7"/></svg>',
    package: '<svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',
    check: '<svg viewBox="0 0 24 24"><rect x="8" y="2" width="8" height="4" rx="1"/><rect x="4" y="4" width="16" height="18" rx="2"/><path d="M9 11l3 3 6-6"/></svg>',
    folder: '<svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>',
    qrcode: '<svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="3" height="3"/><rect x="18" y="14" width="3" height="3"/><rect x="14" y="18" width="3" height="3"/><rect x="18" y="18" width="3" height="3"/></svg>',
    graduation: '<svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M22 12v5M6 10v8c0 2 4 4 6 4s6-2 6-4v-8"/></svg>',
    book: '<svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>',
    chat: '<svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>',
    dashboard: '<svg viewBox="0 0 24 24"><path d="M3 3h7v9H3zM14 3h7v5h-7zM14 12h7v9h-7zM3 16h7v5H3z"/></svg>',
  };

  // Apps
  const ALL_APPS = {
    einsaetze: { id: 'einsaetze', name: 'Einsätze', icon: 'siren', url: 'einsaetze.html', permission: 'einsaetze' },
    patienten: { id: 'patienten', name: 'Patienten', icon: 'clipboard', url: 'patientendokumentation-dateien.html', permission: 'patienten' },
    dokumente: { id: 'dokumente', name: 'Vorgänge', icon: 'file', url: 'dokumente-bearbeiten.html', permission: 'dokumente' },
    lager: { id: 'lager', name: 'Lager', icon: 'package', url: 'lagerverwaltung.html', permission: 'lager' },
    produktausgabe: { id: 'produktausgabe', name: 'Ausgabe', icon: 'check', url: 'produktausgabe.html', permission: 'produktausgabe' },
    dateien: { id: 'dateien', name: 'Dateien', icon: 'folder', url: 'dateien.html', permission: 'dateien' },
    qr: { id: 'qr', name: 'QR-Codes', icon: 'qrcode', url: 'qr-code-generator.html', permission: 'qr' },
    lernbar: { id: 'lernbar', name: 'Lernbar', icon: 'graduation', url: 'lernbar.html', permission: 'lernbar' },
    ausbildungen: { id: 'ausbildungen', name: 'Ausbildungen', icon: 'book', url: 'ausbildungen.html', permission: 'ausbildungen_manage' },
    dashboard: { id: 'dashboard', name: 'Dashboard', icon: 'dashboard', url: 'mpg-dashboard.html', permission: 'dashboard' }
  };

  const ROLES = {
    mpg: { permissions: { dashboard: true, einsaetze: true, lager: true, produktausgabe: true, lernbar: true, ausbildungen_manage: true, dokumente: true, patienten: true, dateien: true, qr: true, chat: true } },
    lager: { permissions: { dashboard: true, lager: true, produktausgabe: true, dateien: true, qr: true, chat: true } },
    ausbildung: { permissions: { dashboard: true, einsaetze: true, lernbar: true, ausbildungen_manage: true, patienten: true, dateien: true, qr: true, chat: true } },
    qm: { permissions: { dashboard: true, dokumente: true, dateien: true, qr: true, chat: true } },
    benutzer: { permissions: { dashboard: true, lernbar: true, chat: true } }
  };

  let user, userApps = [], dockApps = ['chat', 'dashboard'], availableApps = [], editMode = false;

  async function init() {
    if (!pb.authStore.isValid) return window.location.href = 'mpg-login.html';
    try {
      await pb.collection('users').authRefresh();
      user = pb.authStore.model;
      if (!user) return window.location.href = 'mpg-login.html';
      
      document.body.classList.add('loaded');
      updateTime();
      setInterval(updateTime, 60000);
      
      document.getElementById('userName').textContent = user.name || user.email.split('@')[0];
      
      loadPrefs();
      render();
    } catch (e) {
      pb.authStore.clear();
      window.location.href = 'mpg-login.html';
    }
  }

  function updateTime() {
    const now = new Date();
    document.getElementById('time').textContent = 
      `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
  }

  function hasPermission(perm) {
    if (user.supervisor) return true;
    const perms = user.permissions || {};
    const role = ROLES[user.role || 'benutzer'];
    if (perms[perm]) return true;
    if (role?.permissions[perm]) return true;
    if (perm === 'lernbar' && user.lernbar_access) return true;
    return false;
  }

  function loadPrefs() {
    const saved = localStorage.getItem(`hub_apps_${user.id}`);
    userApps = saved ? JSON.parse(saved) : Object.keys(ALL_APPS).filter(id => {
      const app = ALL_APPS[id];
      return hasPermission(app.permission) && !dockApps.includes(id);
    });
    
    availableApps = Object.keys(ALL_APPS).filter(id => {
      const app = ALL_APPS[id];
      return hasPermission(app.permission) && !userApps.includes(id) && !dockApps.includes(id);
    });
  }

  function savePrefs() {
    localStorage.setItem(`hub_apps_${user.id}`, JSON.stringify(userApps));
  }

  function render() {
    renderWidgets();
    renderApps();
    renderDock();
    renderAvailable();
  }

  function renderWidgets() {
    const today = new Date();
    document.getElementById('widgets').innerHTML = `
      <div class="widget">
        <div class="widget-title">Heute</div>
        <div class="widget-value">${today.getDate()}</div>
        <div class="widget-label">${today.toLocaleDateString('de-DE', { weekday: 'long' })}</div>
      </div>
      <div class="widget">
        <div class="widget-title">Apps</div>
        <div class="widget-value">${userApps.length + dockApps.length}</div>
        <div class="widget-label">Installiert</div>
      </div>
    `;
  }

  function renderApps() {
    document.getElementById('apps').innerHTML = userApps.map(id => {
      const app = ALL_APPS[id];
      if (!app) return '';
      return `
        <a href="${app.url}" class="app">
          <div class="remove-btn" onclick="removeApp(event, '${id}')">−</div>
          <div class="app-icon">${ICONS[app.icon]}</div>
          <div class="app-name">${app.name}</div>
        </a>
      `;
    }).join('');
  }

  function renderDock() {
    document.getElementById('dock').innerHTML = dockApps.map(id => {
      const app = ALL_APPS[id];
      return app ? `<a href="${app.url}" class="dock-icon">${ICONS[app.icon]}</a>` : '';
    }).join('');
  }

  function renderAvailable() {
    document.getElementById('availableApps').innerHTML = availableApps.length ? availableApps.map(id => {
      const app = ALL_APPS[id];
      if (!app) return '';
      return `
        <div class="available-app" onclick="addApp('${id}')">
          <div class="available-icon">${ICONS[app.icon]}</div>
          <div class="available-name">${app.name}</div>
        </div>
      `;
    }).join('') : '<p style="text-align:center;color:#999;padding:40px">Alle Apps hinzugefügt</p>';
  }

  window.addApp = function(id) {
    if (userApps.includes(id)) return;
    userApps.push(id);
    availableApps = availableApps.filter(x => x !== id);
    savePrefs();
    render();
  };

  window.removeApp = function(e, id) {
    e.preventDefault();
    e.stopPropagation();
    if (!editMode) return;
    userApps = userApps.filter(x => x !== id);
    availableApps.push(id);
    savePrefs();
    render();
  };

  window.closeModal = function(id) {
    document.getElementById(id).classList.remove('show');
    if (id === 'appsModal') {
      editMode = false;
      document.querySelector('.content').classList.remove('edit-mode');
    }
  };

  document.getElementById('editAppsBtn').onclick = () => {
    editMode = true;
    document.querySelector('.content').classList.add('edit-mode');
    document.getElementById('appsModal').classList.add('show');
  };

  document.getElementById('editWidgetsBtn').onclick = () => {
    document.getElementById('widgetsModal').classList.add('show');
  };

  document.getElementById('logoutBtn').onclick = () => {
    if (confirm('Wirklich abmelden?')) {
      pb.authStore.clear();
      localStorage.clear();
      window.location.href = 'mpg-login.html';
    }
  };

  document.getElementById('editToggle').onclick = () => {
    document.getElementById('editSection').classList.toggle('collapsed');
  };

  // Close modals on background click
  document.querySelectorAll('.modal').forEach(modal => {
    modal.onclick = (e) => {
      if (e.target === modal) closeModal(modal.id);
    };
  });

  init();
</script>

</body>
</html>
