<!DOCTYPE html>

<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dokumentenverwaltung – Responda</title>

  <!-- Fonts & Icons -->

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <!-- External Libraries -->

  <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.21.3/dist/pocketbase.umd.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.6.0/jspdf.plugin.autotable.min.js"></script>

  <!-- HUB-DESIGN (ZENTRAL!) -->

  <link rel="stylesheet" href="hub-styles.css">
</head>

<body class="loading">

<!-- ==================== STATUS BAR START ==================== -->

  <div class="status-bar">
    <div class="logo">
      <svg width="140" height="32" viewBox="0 0 560 140" fill="white">
        <text x="10" y="100" font-size="120" font-weight="800" font-family="Inter">Responda</text>
      </svg>
    </div>
    <div id="userName"></div>
    <button class="logout-btn" id="logout">
      <i class="fa-solid fa-right-from-bracket"></i> Abmelden
    </button>
  </div>
<!-- ==================== STATUS BAR END ==================== -->

<!-- ==================== MAIN CONTENT START ==================== -->

  <div class="content">

```
<!-- TABS -->
<div class="tabs">
  <button class="tab active" data-tab="pat">
    <i class="fa-solid fa-file-medical"></i> Patientendokus
  </button>
  <button class="tab" data-tab="nach">
    <i class="fa-solid fa-clipboard-list"></i> Nacherfassungen
  </button>
  <button class="tab" data-tab="archiv">
    <i class="fa-solid fa-box-archive"></i> Archiv
  </button>
</div>

<!-- TAB: PATIENTENDOKUS (OFFEN) -->
<div id="tab-pat" class="tab-content">
  <div id="pat-rows"></div>
</div>

<!-- TAB: NACHERFASSUNGEN (OFFEN) -->
<div id="tab-nach" class="tab-content" style="display:none">
  <div id="nach-rows"></div>
</div>

<!-- TAB: ARCHIV -->
<div id="tab-archiv" class="tab-content" style="display:none">
  <div id="archiv-rows"></div>
</div>

<div id="msg"></div>
```

  </div>
<!-- ==================== MAIN CONTENT END ==================== -->

<!-- ==================== ADD BUTTON START ==================== -->

  <button class="fab" id="addBtn" title="Neue Nacherfassung">
    <i class="fa-solid fa-plus"></i>
  </button>
<!-- ==================== ADD BUTTON END ==================== -->

<!-- ==================== EDIT MODAL START ==================== -->

  <div class="modal" id="editModal">
    <div class="modal-box">
      <h3><i class="fa-solid fa-edit"></i> Patientendokumentation bearbeiten</h3>
      <div id="editFormContainer"></div>
      <div style="display:flex;gap:10px;margin-top:20px;justify-content:flex-end;position:sticky;bottom:0;background:#fff;padding-top:16px;border-top:2px solid #e2e8f0">
        <button class="btn btn-secondary" onclick="closeEditModal()">
          <i class="fa-solid fa-times"></i> Abbrechen
        </button>
        <button class="btn" onclick="saveAndSignPatDoc()">
          <i class="fa-solid fa-save"></i> Speichern & Gegenzeichnen
        </button>
      </div>
    </div>
  </div>
<!-- ==================== EDIT MODAL END ==================== -->

<!-- ==================== SIGN MODAL START ==================== -->

  <div class="modal" id="signModal">
    <div class="modal-box" style="max-width:600px">
      <h3><i class="fa-solid fa-signature"></i> Verantwortlicher / MPG-Beauftragter</h3>
      <p>Dokument wurde geprüft und ist korrekt. Mit Unterschrift wird es ins Archiv verschoben.</p>
      <div class="form-group">
        <label>Name (Verantwortlicher / MPG-Beauftragter):</label>
        <input type="text" id="adminName" placeholder="Ihr Name">
      </div>
      <div class="sig-wrap">
        <label style="font-weight:700;margin-bottom:8px;display:block">Unterschrift:</label>
        <canvas id="adminSigCanvas" class="sig-canvas"></canvas>
        <div class="sig-actions">
          <button class="btn btn-secondary" onclick="clearAdminSig()">
            <i class="fa-solid fa-eraser"></i> Löschen
          </button>
        </div>
      </div>
      <div style="display:flex;gap:10px;margin-top:20px;justify-content:flex-end">
        <button class="btn btn-secondary" onclick="closeSignModal()">Abbrechen</button>
        <button class="btn" onclick="archiveWithSignature()">
          <i class="fa-solid fa-check"></i> Unterschreiben & Archivieren
        </button>
      </div>
    </div>
  </div>
<!-- ==================== SIGN MODAL END ==================== -->

<!-- ==================== NACHERFASSUNG MODAL START ==================== -->

  <div class="modal" id="nachModal">
    <div class="modal-box">
      <h3><i class="fa-solid fa-clipboard-list"></i> Einsatznacherfassung</h3>
      <form id="nachForm">
        <div class="form-grid">
          <div class="form-group">
            <label>Datum/Alarmzeit:</label>
            <input type="datetime-local" name="datum_alarmzeit">
          </div>
          <div class="form-group">
            <label>Datum/Einsatzende:</label>
            <input type="datetime-local" name="datum_einsatzende">
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Stichwort:</label>
            <input type="text" name="stichwort">
          </div>
          <div class="form-group">
            <label>Kategorie:</label>
            <input type="text" name="kategorie">
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Einsatznummer der ILS:</label>
            <input type="text" name="einsatznummer_ils">
          </div>
          <div class="form-group">
            <label>Meldebild:</label>
            <input type="text" name="meldebild">
          </div>
        </div>
        <div class="form-group">
          <label>Adresse:</label>
          <textarea name="adresse"></textarea>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Disponierte EM (FW):</label>
            <input type="text" name="disponierte_em_fw">
          </div>
          <div class="form-group">
            <label>Disponierte EM (RD):</label>
            <input type="text" name="disponierte_em_rd">
          </div>
        </div>
        <h4 style="margin-top:20px;color:#667eea">Patienten-Daten</h4>
        <div class="form-group">
          <label>Erhoben:</label>
          <div class="radio-group">
            <label><input type="radio" name="patienten_daten_erhoben" value="ja"> Ja</label>
            <label><input type="radio" name="patienten_daten_erhoben" value="nein"> Nein</label>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Name:</label>
            <input type="text" name="patient_name">
          </div>
          <div class="form-group">
            <label>Alter/Geburtsdatum:</label>
            <input type="text" name="patient_alter_geburtsdatum">
          </div>
          <div class="form-group">
            <label>Pat.-Nummer der ILS:</label>
            <input type="text" name="patient_nummer_ils">
          </div>
        </div>
        <div class="form-group">
          <label>Sachverhalt vor Ort:</label>
          <textarea name="sachverhalt" rows="4"></textarea>
        </div>
        <h4 style="margin-top:20px;color:#667eea">Protokollpflicht</h4>
        <div class="form-group">
          <label>War dieser Einsatz gemäß §630f BGB protokollpflichtig?</label>
          <div class="radio-group">
            <label><input type="radio" name="protokollpflichtig" value="ja"> Ja</label>
            <label><input type="radio" name="protokollpflichtig" value="nein"> Nein</label>
          </div>
        </div>
        <div class="form-group">
          <label>Begründung:</label>
          <textarea name="protokollpflichtig_begruendung"></textarea>
        </div>
        <div class="form-group">
          <label>War die verantwortliche Person mit der Thematik der Einsatz-/Patientendokumentation (gem. §630f BGB) unterwiesen?</label>
          <div class="radio-group">
            <label><input type="radio" name="verantwortlicher_unterwiesen" value="ja"> Ja</label>
            <label><input type="radio" name="verantwortlicher_unterwiesen" value="nein"> Nein</label>
          </div>
        </div>
        <h4 style="margin-top:20px;color:#667eea">Verantwortlicher</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Name:</label>
            <input type="text" name="verantwortlicher_name">
          </div>
          <div class="form-group">
            <label>Qualifikation:</label>
            <input type="text" name="verantwortlicher_qualifikation">
          </div>
        </div>
        <h4 style="margin-top:20px;color:#667eea">Nacherfassung</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Nacherfasst von (Name):</label>
            <input type="text" name="nacherfasst_von_name" required>
          </div>
          <div class="form-group">
            <label>Qualifikation:</label>
            <input type="text" name="nacherfasst_von_qualifikation">
          </div>
        </div>
        <div class="sig-wrap">
          <label style="font-weight:700;margin-bottom:8px;display:block">Unterschrift:</label>
          <canvas id="nachSigCanvas" class="sig-canvas"></canvas>
          <div class="sig-actions">
            <button type="button" class="btn btn-secondary" onclick="clearNachSig()">
              <i class="fa-solid fa-eraser"></i> Löschen
            </button>
          </div>
        </div>
      </form>
      <div style="display:flex;gap:10px;margin-top:20px;justify-content:flex-end">
        <button class="btn btn-secondary" onclick="closeNachModal()">Abbrechen</button>
        <button class="btn" onclick="saveNacherfassung()">
          <i class="fa-solid fa-save"></i> Speichern
        </button>
      </div>
    </div>
  </div>
<!-- ==================== NACHERFASSUNG MODAL END ==================== -->

<!-- ==================== DETAILS MODAL START ==================== -->

  <div class="modal" id="detailsModal">
    <div class="modal-box">
      <h3 id="detailsTitle">Details</h3>
      <div id="detailsBody"></div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px">
        <button class="btn btn-secondary" onclick="closeDetailsModal()">
          <i class="fa-solid fa-times"></i> Schließen
        </button>
        <button class="btn" onclick="generatePDFFromModal()">
          <i class="fa-solid fa-file-pdf"></i> PDF erstellen
        </button>
      </div>
    </div>
  </div>
<!-- ==================== DETAILS MODAL END ==================== -->

<!-- ==================== JAVASCRIPT START ==================== -->

  <script type="module" src="patientendokumentation-dateien.js"></script>

<!-- ==================== JAVASCRIPT END ==================== -->

</body>
</html>
